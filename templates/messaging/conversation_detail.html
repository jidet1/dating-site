{% extends 'base.html' %}

{% block title %}Conversation - LoveMatch{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 2rem auto; padding: 1rem;">
    <div class="card">
        <h2 class="heading-xl" style="margin-bottom: 1rem;">Chat with {{ other_user.username }}</h2>

        <div id="messagesContainer" style="max-height: 500px; overflow-y: auto; padding: 1rem; background-color: #f9f9f9; border-radius: 10px; box-sizing: border-box;">
            {% for message in messages %}
            <div style="margin-bottom: 1rem; display: flex; {% if message.sender == user %}justify-content: flex-end;{% else %}justify-content: flex-start;{% endif %}">
                <div style="
                    max-width: 70%;
                    {% if message.sender == user %}
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border-radius: 18px 18px 4px 18px;
                    {% else %}
                        background: rgba(255, 255, 255, 0.9);
                        color: #333;
                        border-radius: 18px 18px 18px 4px;
                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                    {% endif %}
                    padding: 0.8rem 1.2rem;
                    backdrop-filter: blur(10px);
                    word-break: break-word;
                    overflow-wrap: break-word;
                    box-sizing: border-box;
                ">
                    <p style="margin: 0; line-height: 1.4;">{{ message.content }}</p>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.7rem; {% if message.sender == user %}color: rgba(255, 255, 255, 0.8);{% else %}color: #999;{% endif %}">
                        {{ message.created_at|date:"M d, H:i" }}
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>

        <form method="post" style="margin-top: 2rem;">
            {% csrf_token %}
            <div class="form-group">
                {{ form.content }}
            </div>
            <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Send</button>
        </form>
    </div>
</div>

<style>
    .card {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    }

    textarea {
        width: 100%;
        height: 100px;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #ddd;
        box-sizing: border-box;
        resize: vertical;
        font-size: 1rem;
    }

    .btn-primary {
        background-color: #667eea;
        color: white;
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
    }

    .btn-primary:hover {
        background-color: #5a67d8;
    }

    .heading-xl {
        font-size: 2rem;
        font-weight: bold;
        color: #333;
    }

    @media (max-width: 600px) {
        .heading-xl {
            font-size: 1.5rem;
        }

        #messagesContainer div {
            max-width: 85% !important;
        }
    }
</style>
{% endblock %}
